!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("NPlayerDanmaku",[],e):"object"==typeof exports?exports.NPlayerDanmaku=e():t.NPlayerDanmaku=e()}(this,(function(){return function(){var t={498:function(t,e,i){"use strict";i.r(e);var n=i(81),o=i.n(n),a=i(645),s=i.n(a)()(o());s.push([t.id,".nplayer_danmaku_screen{bottom:0;left:0;overflow:hidden;pointer-events:none;position:absolute;right:0;top:0}.nplayer_danmaku_send{align-items:center;background:rgba(255,255,255,.15);display:flex;flex:1;font-size:0;margin:0 10px!important}.nplayer_danmaku_send input{background:transparent;border:0;color:currentColor;flex:1;font-size:13px;outline:0;padding:0;width:100px}.nplayer_danmaku_send input::-moz-placeholder{color:rgba(255,255,255,.5)}.nplayer_danmaku_send input:-ms-input-placeholder{color:rgba(255,255,255,.5)}.nplayer_danmaku_send input::placeholder{color:rgba(255,255,255,.5)}.nplayer_danmaku_send_btn{cursor:pointer;font-size:12px;padding:0 10px;white-space:nowrap}.nplayer_danmaku_send .nplayer_popover_panel{font-size:13px;padding:0 15px}.nplayer_danmaku_send .nplayer_checkbox{margin-top:3px}.nplayer_danmaku_send .nplayer_checkbox+.nplayer_checkbox{margin-left:10px}.nplayer_danmaku_colors{align-items:center;display:flex;flex-wrap:wrap;padding-bottom:12px}.nplayer_danmaku_color{height:19px;margin-bottom:5px;margin-right:5px;width:19px}.nplayer_danmaku_color_row{align-items:stretch;display:flex;margin:5px 0}.nplayer_danmaku_color_row input{border:1px solid rgba(255,255,255,.8);flex:3;letter-spacing:1px;padding:0 5px;width:0}.nplayer_danmaku_color_preview{flex:2;height:20px;margin-left:5px}.nplayer_danmaku_color:hover{transform:scale(1.1)}.nplayer_danmaku_row{justify-content:space-between;margin:12px 0}.nplayer_danmaku_onoff_label{margin-right:5px;margin-top:-2px}.nplayer_danmaku_reset{border:1px solid rgba(255,255,255,.5);margin-left:auto;padding:2px 5px;transition:opacity .2s ease}.nplayer_danmaku_reset:hover{opacity:.7}.nplayer_danmaku_setting{font-size:13px;padding:10px 20px}.nplayer_danmaku_setting .nplayer_slider{margin:3px 12px}.nplayer_danmaku_setting .nplayer_checkbox{margin-top:5px}.nplayer_danmaku_setting .nplayer_checkbox+.nplayer_checkbox{margin-left:15px}.nplayer_danmaku_item{color:#fff;letter-spacing:1px;line-height:1.125;position:absolute;text-shadow:#000 1px 0 1px,#000 0 1px 1px,#000 0 -1px 1px,#000 -1px 0 1px;white-space:nowrap;will-change:transform}.nplayer_danmaku_item-center{left:50%;transform:translateX(-50%);will-change:auto;z-index:1}.nplayer_danmaku_item-me{outline:2px solid;z-index:2}",""]),e.default=s},645:function(t){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",n=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),n&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),n&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,n,o,a){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(n)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var u=0;u<t.length;u++){var p=[].concat(t[u]);n&&s[p[0]]||(void 0!==a&&(void 0===p[5]||(p[1]="@layer".concat(p[5].length>0?" ".concat(p[5]):""," {").concat(p[1],"}")),p[5]=a),i&&(p[2]?(p[1]="@media ".concat(p[2]," {").concat(p[1],"}"),p[2]=i):p[2]=i),o&&(p[4]?(p[1]="@supports (".concat(p[4],") {").concat(p[1],"}"),p[4]=o):p[4]="".concat(o)),e.push(p))}},e}},81:function(t){"use strict";t.exports=function(t){return t[1]}},132:function(t,e,i){var n;"undefined"!=typeof window&&window.document&&function(){var t=i(498);t.__esModule&&(t=t.default);var e="string"==typeof t?t:t[0][1],o=!1;n||((n=document.createElement("style")).setAttribute("type","text/css"),o=!0),"textContent"in n?n.textContent=e:n.styleSheet.cssText=e,o&&document.head.appendChild(n)}()}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={id:n,exports:{}};return t[n](a,a.exports,i),a.exports}i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return function(){"use strict";i.d(n,{default:function(){return tt}});var t;i(132);function e(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t){return!t||"string"==typeof t&&("#fff"===(t=t.toLowerCase())||"#ffffff"===t)}var a="nplayer:danmaku";var s="Send settings",r="Send",l="Mode",u="Scroll",p="Top",h="Bottom",c="Color",d="Color",f="Danmaku settings",m="On/Off",y="Restore settings",v="Block by type",k="Opacity &nbsp;",b="Area &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",g="Half",_="Full",w="Speed &nbsp;&nbsp;&nbsp;",x="Slow",C="Fast",E="Font size",S="Small",T="Unlimited",P="Bottom to top",O=(e(t={},s,"发送设置"),e(t,r,"发送"),e(t,l,"模式"),e(t,u,"滚动"),e(t,p,"顶部"),e(t,h,"底部"),e(t,c,"颜色"),e(t,d,"彩色"),e(t,f,"弹幕设置"),e(t,m,"开/关"),e(t,y,"恢复默认设置"),e(t,v,"按类型屏蔽"),e(t,k,"不透明度"),e(t,b,"显示区域"),e(t,g,"半屏"),e(t,_,"全屏"),e(t,w,"弹幕速度"),e(t,x,"慢"),e(t,C,"快"),e(t,E,"字体大小"),e(t,S,"小"),e(t,"Big","大"),e(t,T,"不限弹幕"),e(t,P,"从下到上"),t),B={DANMAKU_SEND:"DanmakuSend",DANMAKU_UPDATE_OPTIONS:"DanmakuUpdateOptions"};function A(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function D(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var I="nplayer_danmaku_item",z=function(){function t(e,i,n,o){var a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),D(this,"width",0),D(this,"left",0),D(this,"length",0),D(this,"startAt",0),D(this,"showAt",0),D(this,"endAt",0),D(this,"speed",0),D(this,"track",0),D(this,"ended",!1),D(this,"color",""),D(this,"end",(function(){a.el.removeEventListener("transitionend",a.end),clearTimeout(a.centerTimer),a.el.style.cssText="",a.color="",a.el.className=I,a.ended=!0,a.hide(),a.danmaku.recycleBullet(a)})),this.danmaku=i,this.el=e.appendChild(document.createElement("div")),this.el.className=I,this.init(n,o)}var e,i,n;return e=t,(i=[{key:"init",value:function(t,e){this.el.textContent=t.text,this.type=t.type||"scroll",this.track=e.track,t.color&&(this.el.style.color=this.color=t.color),t.isMe&&this.el.classList.add("nplayer_danmaku_item-me");var i=this.el.style;if(i.fontSize="".concat(this.danmaku.fontsize,"px"),this.startAt=this.danmaku.timer.now(),"scroll"===this.type){this.el.addEventListener("transitionend",this.end);var n=this.el.getBoundingClientRect();this.width=(this.danmaku.heightGtWidth?n.height:n.width)+20;var o=this.danmaku.width,a=e.prev;if(this.left=o,this.speed=this.danmaku.speedScale*(o+this.width)/this.danmaku.opts.duration,a&&!a.ended){var s=a.length-o-(this.startAt-a.startAt)*a.speed;if(s>=0)this.speed=a.speed,this.left+=s;else{var r=this.danmaku.width/(a.endAt-this.startAt);this.speed>r&&(this.speed=r)}}this.length=this.left+this.width;var l=this.length/this.speed;this.showAt=this.startAt+(this.length-o)/this.speed,this.endAt=this.startAt+l,this.updateScrollY(),i.left="".concat(this.left,"px"),i.transition="transform ".concat(l,"s linear"),i.transform="translate3d(-".concat(this.length,"px,0,0)")}else{i[this.type]=this.pos(),this.el.classList.add("nplayer_danmaku_item-center");var u=this.danmaku.speedScale*this.danmaku.opts.duration;this.endAt=this.startAt+u,this.centerTimer=setTimeout(this.end,1e3*u)}return this.ended=!1,this.show(),this.danmaku.paused&&this.pause(this.startAt),this}},{key:"pos",value:function(){return"".concat(this.track*this.danmaku.trackHeight+2,"px")}},{key:"updateScrollY",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.danmaku.opts.bottomUp;if("scroll"===this.type){var e=this.el.style;e.top=e.bottom="",e[t?"bottom":"top"]=this.pos()}}},{key:"show",value:function(){this.el.style.visibility=""}},{key:"hide",value:function(){this.el.style.visibility="hidden"}},{key:"pause",value:function(t){if("scroll"===this.type){var e=this.el.style;e.transition="transform 0s linear",e.transform="translate3d(-".concat((t-this.startAt)*this.speed,"px,0,0)")}else clearTimeout(this.centerTimer)}},{key:"run",value:function(t){if("scroll"===this.type){var e=this.el.style;e.transition="transform ".concat(this.endAt-t,"s linear"),e.transform="translate3d(-".concat(this.length,"px,0,0)")}else this.centerTimer=setTimeout(this.end,1e3*(this.endAt-t))}}])&&A(e.prototype,i),n&&A(e,n),t}();function j(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==i)return;var n,o,a=[],s=!0,r=!1;try{for(i=i.call(t);!(s=(n=i.next()).done)&&(a.push(n.value),!e||a.length!==e);s=!0);}catch(t){r=!0,o=t}finally{try{s||null==i.return||i.return()}finally{if(r)throw o}}return a}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return N(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return N(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function F(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function U(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?F(Object(i),!0).forEach((function(e){L(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function M(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function L(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var H,K=function(){return{disable:!1,blocked:[],fontsize:24,fontsizeScale:1,opacity:1,speed:1,area:.5,unlimited:!1,bottomUp:!1,colors:["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#CC0273","#222222","#FFFFFF"],duration:5,items:[],zIndex:5,persistOptions:!1,isDefaultColor:o,maxPerInsert:20,poolSize:50,discard:function(){return!1}}},G=function(){function t(e,i){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),L(this,"enabled",!1),L(this,"paused",!1),L(this,"track",0),L(this,"trackHeight",0),L(this,"heightGtWidth",!1),L(this,"bulletPool",[]),L(this,"aliveBullets",new Set),L(this,"scrollBullets",[]),L(this,"topBullets",[]),L(this,"bottomBullets",[]),L(this,"items",[]),L(this,"pos",0),L(this,"prevPauseTime",0),L(this,"fire",(function(){if(n.enabled&&n.player.playing){n.paused&&n.resume();for(var t,e=n.currentTime,i=n.opts.unlimited?.5:1,o=e-i,a=e+i,s=n.timer.now(),r=n.items.length,l=0,u=n.opts.maxPerInsert;n.pos<r;n.pos++)if(!((t=n.items[n.pos]).time<o)){if(t.time>a)break;if(!n.shouldDiscard(t)){if(!n.insert(t,s))break;if(++l>u)break}}}})),L(this,"updateTrack",(function(){var t=n.probeEl.getBoundingClientRect(),e=t.width,i=t.height;n.heightGtWidth=i>e;var o=n.heightGtWidth?n.player.rect.width:n.player.rect.height;n.trackHeight=n.fontsize+5,n.track=Math.floor(o*n.opts.area/n.trackHeight)})),L(this,"onSeeked",(function(){n.clearScreen(),n.pos=0})),L(this,"pause",(function(){n.prevPauseTime=n.timer.now(),n.timer.pause(),n.aliveBullets.forEach((function(t){return t.pause(n.prevPauseTime)})),n.paused=!0})),L(this,"resume",(function(){n.player.playing&&!n.player.loading.isActive&&(n.timer.play(),n.aliveBullets.forEach((function(t){return t.run(n.prevPauseTime)})),n.paused=!1)})),this.player=e,this._opts=i,this.opts=U(U(U({},K()),function(){try{var t=window.localStorage.getItem(a);if(!t)return;return JSON.parse(t)}catch(t){}}()),i);var o=e.Player.__utils,s=o.$,r=o.addDisposable;this.el=e.el.appendChild(s(".danmaku_screen")),this.el.style.zIndex=String(this.opts.zIndex),this.probeEl=this.el.appendChild(s());var l=this.probeEl.style;l.position="absolute",l.zIndex="-9",l.width="2px",l.height="1px",l.opacity="0",this.items=Array.isArray(this.opts.items)?this.opts.items:[],this.timer={_prevPauseTime:0,_pausedTime:0,_paused:!1,now:function(){return((this._paused?this._prevPauseTime:Date.now())-this._pausedTime)/1e3},play:function(){this._paused&&(this._pausedTime+=Date.now()-this._prevPauseTime,this._paused=!1)},pause:function(){this._paused||(this._prevPauseTime=Date.now(),this._paused=!0)}},this.opts.disable||this.enable(),r(this,e.on(e.EVENT.MOUNTED,this.updateTrack)),r(this,e.on(e.EVENT.UPDATE_SIZE,this.updateTrack)),r(e,this)}var e,i,n;return e=t,(i=[{key:"width",get:function(){return this.heightGtWidth?this.player.rect.height:this.player.rect.width}},{key:"currentTime",get:function(){return this.player.currentTime}},{key:"playbackRate",get:function(){return this.player.playbackRate}},{key:"fontsize",get:function(){return this.opts.fontsize*this.opts.fontsizeScale}},{key:"speedScale",get:function(){return this.playbackRate*this.opts.speed}},{key:"createBullet",value:function(t,e){var i=this.bulletPool.pop();return i?i.init(t,e):i=new z(this.el,this,t,e),this.aliveBullets.add(i),i}},{key:"unmountBullet",value:function(t){t.el&&t.el.parentNode&&t.el.parentNode.removeChild(t.el)}},{key:"getShortestTrack",value:function(){var t=this.scrollBullets[0];if(!t||t.ended)return[0];for(var e,i=1;i<this.track;++i){if(!(e=this.scrollBullets[i])||e.ended)return[i];t.showAt>e.showAt&&(t=e)}return[t.track,t]}},{key:"getEmptyTrack",value:function(t,e){for(var i=0;i<this.track;++i)if(!e[i]||e[i]<=t)return i;return-1}},{key:"shouldDiscard",value:function(t){return!(!this.opts.blocked.includes(t.type||"scroll")&&!this.opts.discard(t)&&(!t.color||!this.opts.blocked.includes("color")||this.opts.isDefaultColor(t.color)))}},{key:"storeOptions",value:function(){if(this.player.emit(B.DANMAKU_UPDATE_OPTIONS,this.opts),this.opts.persistOptions){var t=this.opts;!function(t){try{window.localStorage.setItem(a,JSON.stringify(t))}catch(t){}}({blocked:t.blocked,fontsizeScale:t.fontsizeScale,opacity:t.opacity,speed:t.speed,area:t.area,unlimited:t.unlimited,bottomUp:t.bottomUp})}}},{key:"recycleBullet",value:function(t){this.bulletPool.length>this.opts.poolSize?this.unmountBullet(t):this.bulletPool.push(t),this.aliveBullets.delete(t),"scroll"===t.type&&this.scrollBullets[t.track]===t&&(this.scrollBullets[t.track]=void 0)}},{key:"insert",value:function(t,e){if(!t.type||"scroll"===t.type){var i=j(this.getShortestTrack(),2),n=i[0],o=i[1],a=!t.force&&o&&o.showAt>e+2;return!(a&&!this.opts.unlimited||(this.scrollBullets[n]=this.createBullet(t,{track:n,prev:a?void 0:o}),0))}var s="top"===t.type?this.topBullets:this.bottomBullets,r=this.getEmptyTrack(e,s);return-1!==(r=-1===r&&t.force?0:r)&&(s[r]=this.createBullet(t,{track:r}).endAt,!0)}},{key:"send",value:function(t){null==t.time&&(t.time=this.currentTime),t=U({isMe:!0,force:!0},t),this.player.emit(B.DANMAKU_SEND,t);var e=this.addItem(t);this.pos>e&&this.insert(t,this.timer.now())}},{key:"getItems",value:function(){return this.items}},{key:"addItem",value:function(t){if(null==t.time)return-1;var e=this.items.length;if(!e||t.time>=this.items[e-1].time)return this.items.push(t),e;if(t.time<=this.items[0].time)return this.items.unshift(t),0;for(var i=0,n=0;n<e;n++)if(this.items[n].time>t.time){i=n;break}return this.items.splice(i,0,t),i}},{key:"appendItems",value:function(t){this.items=this.items.concat(t)}},{key:"resetItems",value:function(t){this.items=t,this.pos=0}},{key:"updateOpacity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.opts.opacity;this.el.style.opacity=String(t),this.storeOptions()}},{key:"updateFontsize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.opts.fontsizeScale;this.opts.fontsizeScale=t,this.updateTrack(),this.storeOptions()}},{key:"updateArea",value:function(t){[.25,.5,.75,1].includes(t)&&(this.opts.area=t,this.updateTrack(),this.storeOptions())}},{key:"updateUnlimited",value:function(t){this.opts.unlimited=t,this.storeOptions()}},{key:"updateBottomUp",value:function(t){this.opts.bottomUp=t,this.aliveBullets.forEach((function(e){return e.updateScrollY(t)})),this.storeOptions()}},{key:"updateSpeed",value:function(t){this.opts.speed=t,this.storeOptions()}},{key:"blockType",value:function(t){var e=this;this.opts.blocked.includes(t)||(this.opts.blocked.push(t),this.aliveBullets.forEach((function(i){(i.type===t||"color"===t&&!e.opts.isDefaultColor(i.color))&&i.hide()})),this.storeOptions())}},{key:"allowType",value:function(t){var e=this;this.opts.blocked=this.opts.blocked.filter((function(e){return e!==t})),this.aliveBullets.forEach((function(i){(i.type===t||"color"===t&&!e.opts.isDefaultColor(i.color))&&i.show()})),this.storeOptions()}},{key:"resetOptions",value:function(){var t=this;this.opts.blocked.forEach((function(e){t.allowType(e)})),this.opts=U(U({},K()),this._opts),this.opts.blocked=[],this.updateOpacity(),this.updateFontsize(),this.updateBottomUp(this.opts.bottomUp)}},{key:"clearScreen",value:function(){Array.from(this.aliveBullets).forEach((function(t){return t.end()})),this.topBullets=[],this.bottomBullets=[]}},{key:"enable",value:function(){if(!this.enabled){this.enabled=!0;var t=this.player.EVENT;this.player.on(t.TIME_UPDATE,this.fire),this.player.on(t.PAUSE,this.pause),this.player.on(t.ENDED,this.pause),this.player.on(t.PLAY,this.resume),this.player.on(t.SEEKED,this.onSeeked),this.player.on(t.LOADING_SHOW,this.pause),this.player.on(t.LOADING_HIDE,this.resume)}}},{key:"disable",value:function(){this.enabled=!1,this.clearScreen();var t=this.player.EVENT;this.player.off(t.TIME_UPDATE,this.fire),this.player.off(t.PAUSE,this.pause),this.player.off(t.ENDED,this.pause),this.player.off(t.PLAY,this.resume),this.player.off(t.SEEKED,this.onSeeked),this.player.off(t.LOADING_SHOW,this.pause),this.player.off(t.LOADING_HIDE,this.resume)}},{key:"dispose",value:function(){this.player&&(this.disable(),this.player.Player.__utils.removeNode(this.el),this.player.Player.__utils.dispose(this),this.player=null,this.bulletPool=null,this.aliveBullets=null,this.scrollBullets=null,this.topBullets=null,this.bottomBullets=null,this.items=null,this.el=null,this.opts=null)}}])&&M(e.prototype,i),n&&M(e,n),t}();function V(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function W(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}G.prototype.EVENT=B;var R=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),W(this,"id","danmaku-send"),W(this,"typeCBs",{}),W(this,"currentType","scroll"),W(this,"onTypeChange",(function(t){return function(){e.currentType=t,e.typeCBs.scroll.update(!1),e.typeCBs.top.update(!1),e.typeCBs.bottom.update(!1),e.typeCBs[t].update(!0)}})),W(this,"show",(function(t){t&&H.getEventPath(t).includes(e.popover.el)||(e.tooltip.hide(),e.popover.show())})),W(this,"send",(function(){var t=e.inputEl.value;if(t){e.inputEl.value="";var i={text:t,time:e.player.currentTime,type:e.currentType,color:o(t)?void 0:e.colorInputEl.value};e.player.danmaku.send(i)}}))}var e,i,n;return e=t,(i=[{key:"init",value:function(t,e){var i=this;this.player=t;var n=t.Player,o=n.__utils,a=n.components,d=n.I18n,f=H=o,m=f.$,y=f.addDisposableListener,v=f.addDisposable,k=f.createSvg;this.el=m(".danmaku_send");var b=this.el.appendChild(m());b.appendChild(k("icon","M9.62 14L12 7.67 14.37 14M11 5L5.5 19h2.25l1.12-3h6.25l1.13 3h2.25L13 5h-2z")),this.tooltip=v(this,new a.Tooltip(b,d.t(s))),this.popover=v(this,new a.Popover(b,(function(){return i.tooltip.show()}),void 0,!0)),this.inputEl=this.el.appendChild(m("input")),this.sendEl=this.el.appendChild(m(".danmaku_send_btn",void 0,d.t(r))),this.setPos(e);var g,_=this.popover.panelEl,w=m(".danmaku_row");_.appendChild(w),w.appendChild(m(void 0,void 0,d.t(l))),w=w.appendChild(m(".flex.align-center")),this.typeCBs.scroll=v(this,new a.Checkbox(w,{html:d.t(u),checked:!0,change:this.onTypeChange("scroll")})),this.typeCBs.top=v(this,new a.Checkbox(w,{html:d.t(p),change:this.onTypeChange("top")})),this.typeCBs.bottom=v(this,new a.Checkbox(w,{html:d.t(h),change:this.onTypeChange("bottom")})),w=m(".flex.align-center.danmaku_row"),w=m(".danmaku_row"),_.appendChild(w),w.appendChild(m(void 0,void 0,d.t(c))),w=w.appendChild(m(".danmaku_color_row")),this.colorInputEl=w.appendChild(m("input")),y(this,this.colorInputEl,"input",(function(){i.updateColor(i.colorInputEl.value)})),this.colorEl=w.appendChild(m(".danmaku_color_preview")),y(this,w=m(".danmaku_colors"),"click",(function(t){var e=t.target;e&&e.dataset.value&&i.updateColor(e.dataset.value)})),t.danmaku.opts.colors.forEach((function(t){(g=m(".danmaku_color")).style.background=t,g.dataset.value=t,w.appendChild(g)})),_.appendChild(w),y(this,b,"click",this.show),y(this,this.inputEl,"keypress",(function(t){t.altKey||t.ctrlKey||t.metaKey||t.shiftKey||13===(t.keyCode||t.which)&&i.send()})),y(this,this.inputEl,"focus",(function(){return t.control.require()})),y(this,this.inputEl,"blur",(function(){return t.control.release()})),y(this,this.sendEl,"click",this.send),this.updateColor("#FFFFFF")}},{key:"update",value:function(t){this.setPos(t)}},{key:"setPos",value:function(t){this.popover.resetPos(),2===t&&this.popover.setBottom()}},{key:"updateColor",value:function(t){this.colorInputEl.value=t,this.colorEl.style.background=t,this.inputEl.style.color=t}},{key:"dispose",value:function(){this.player&&(H.dispose(this),H.removeNode(this.el),this.player=null,this.el=null)}}])&&V(e.prototype,i),n&&V(e,n),t}();function Y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var J=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),$(this,"id","danmaku-settings"),$(this,"show",(function(){e.popover.show(),e.tooltip.hide()}))}var e,i,n;return e=t,(i=[{key:"init",value:function(t,e){var i=this;this.player=t;var n=t.Player,o=n.__utils,a=n.components,s=n.I18n,r=o.$,l=o.clamp,c=o.addDisposableListener,O=o.addDisposable,B=o.createSvg;this.el=r(),this.el.appendChild(B("icon","M9 21v2H7v-2h2m4 0v2h-2v-2h2m4 0v2h-2v-2h2M2 19V3h20v16m-11-7H9v2h2v-2m8 0h-6v2h6v-2M7 8H5v2h2V8m12 0H9v2h10V8z")),this.tooltip=O(this,new a.Tooltip(this.el,s.t(f))),this.popover=O(this,new a.Popover(this.el,(function(){return i.tooltip.show()}))),c(this,this.el,"click",this.show);var A=this.popover.panelEl;o.addClass(A,"danmaku_setting"),this.setPos(e),t.on("Mounted",(function(){var e=function(){return r(".flex.align-center.danmaku_row")},n=e();n.appendChild(r(".danmaku_onoff_label",void 0,s.t(m))),O(i,new a.Switch(n,t.danmaku.enabled,(function(e){return t.danmaku[e?"enable":"disable"]()})));var o=n.appendChild(r(".danmaku_reset",void 0,s.t(y)));c(i,o,"click",(function(){t.danmaku.resetOptions(),i.updateSettings()})),A.appendChild(n),n=r(".danmaku_row"),A.appendChild(n),n.appendChild(r(void 0,void 0,s.t(v))),n=n.appendChild(r(".flex.align-center")),i.scrollCB=O(i,new a.Checkbox(n,{html:s.t(u),change:function(e){t.danmaku[e?"blockType":"allowType"]("scroll")}})),i.topCB=O(i,new a.Checkbox(n,{html:s.t(p),change:function(e){t.danmaku[e?"blockType":"allowType"]("top")}})),i.bottomCB=O(i,new a.Checkbox(n,{html:s.t(h),change:function(e){t.danmaku[e?"blockType":"allowType"]("bottom")}})),i.colorCB=O(i,new a.Checkbox(n,{html:s.t(d),change:function(e){t.danmaku[e?"blockType":"allowType"]("color")}})),(n=e()).appendChild(r(void 0,void 0,s.t(k))),i.opacitySlider=O(i,new a.Slider(n,{stops:[{value:0,html:"10%"},{value:1,html:"100%"}],change:function(e){t.danmaku.updateOpacity(l(e+.1,.1,1))}})),A.appendChild(n),(n=e()).appendChild(r(void 0,void 0,s.t(b))),i.areaSlider=O(i,new a.Slider(n,{stops:[{value:0,html:"1/4"},{value:.33,html:s.t(g)},{value:.66,html:"3/4"},{value:1,html:s.t(_)}],step:!0,change:function(e){e=0===e?.25:.33===e?.5:.66===e?.75:1,t.danmaku.updateArea(e)}})),A.appendChild(n),(n=e()).appendChild(r(void 0,void 0,s.t(w))),i.speedSlider=O(i,new a.Slider(n,{stops:[{value:0,html:s.t(x)},{value:1,html:s.t(C)}],change:function(e){t.danmaku.updateSpeed(l(e+.5,.5,1.5))}})),A.appendChild(n),(n=e()).appendChild(r(void 0,void 0,s.t(E))),i.fontsizeSlider=O(i,new a.Slider(n,{stops:[{value:0,html:s.t(S)},{value:1,html:s.t("Big")}],change:function(e){t.danmaku.updateFontsize(l(e+.5,.5,1.5))}})),A.appendChild(n),n=e(),i.unlimitedCB=O(i,new a.Checkbox(n,{html:s.t(T),change:function(e){t.danmaku.updateUnlimited(e)}})),i.bottomUpCB=O(i,new a.Checkbox(n,{html:s.t(P),change:function(e){t.danmaku.updateBottomUp(e)}})),A.appendChild(n),i.updateSettings()}))}},{key:"update",value:function(t){this.setPos(t)}},{key:"setPos",value:function(t){this.popover.resetPos(),2===t&&this.popover.setBottom()}},{key:"updateSettings",value:function(){var t=this.player.danmaku.opts;this.scrollCB.update(t.blocked.includes("scroll")),this.topCB.update(t.blocked.includes("top")),this.bottomCB.update(t.blocked.includes("bottom")),this.colorCB.update(t.blocked.includes("color")),this.unlimitedCB.update(t.unlimited),this.bottomUpCB.update(t.bottomUp),this.opacitySlider.update(t.opacity),this.areaSlider.update({.25:0,.5:.33,.75:.66,1:1}[t.area]),this.speedSlider.update(t.speed-.5),this.fontsizeSlider.update(t.fontsizeScale-.5)}},{key:"dispose",value:function(){this.player&&(this.player.Player.__utils.dispose(this),this.player.Player.__utils.removeNode(this.el),this.player=null)}}])&&Y(e.prototype,i),n&&Y(e,n),t}();function q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var X,Z,Q,tt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.opts=e}var e,i,n;return e=t,(i=[{key:"apply",value:function(t){if(t.registerControlItem(new R),t.registerControlItem(new J),t.Player.I18n.add("zh-cn",O),t.danmaku=new G(t,this.opts),!t.mounted&&this.opts&&!1!==this.opts.autoInsert){var e=t.opts.controls[0].findIndex((function(t){return"spacer"===t}));-1!==e&&t.opts.controls[0].splice(e,1,"danmaku-send","danmaku-settings")}}}])&&q(e.prototype,i),n&&q(e,n),t}();Q=tt,(Z="Plugin")in(X=tt)?Object.defineProperty(X,Z,{value:Q,enumerable:!0,configurable:!0,writable:!0}):X[Z]=Q}(),n=n.default}()}));
//# sourceMappingURL=index.min.js.map